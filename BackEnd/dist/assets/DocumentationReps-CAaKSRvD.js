import{g as W,c as F,a as l,e as A,j as e,s as R,f as B,h as D,aE as G,a0 as w,m as $,aF as O,Q as V,ao as q,a3 as P,O as z,aG as Q}from"./index-cjkKFOZm.js";import{T as Y,a as J,b as K,c as N,d as S,e as X}from"./TableRow-DX4eK4SK.js";import{D as Z,a as ee,b as te}from"./DialogTitle-WWYLQq1n.js";import{T as se}from"./TextField-BfmpNyZ6.js";import{D as oe}from"./DialogActions-BZJ2Nsqg.js";import{S as ie,A as ae}from"./Snackbar-D-WuT-mt.js";import"./IconButton-D5huxE2b.js";function ne(s){return W("MuiImageList",s)}F("MuiImageList",["root","masonry","quilted","standard","woven"]);const k=l.createContext({}),re=s=>{const{classes:t,variant:o}=s;return D({root:["root",o]},ne,t)},le=R("ul",{name:"MuiImageList",slot:"Root",overridesResolver:(s,t)=>{const{ownerState:o}=s;return[t.root,t[o.variant]]}})({display:"grid",overflowY:"auto",listStyle:"none",padding:0,WebkitOverflowScrolling:"touch",variants:[{props:{variant:"masonry"},style:{display:"block"}}]}),ce=l.forwardRef(function(t,o){const c=A({props:t,name:"MuiImageList"}),{children:n,className:g,cols:r=2,component:v="ul",rowHeight:u="auto",gap:h=4,style:I,variant:i="standard",...m}=c,f=l.useMemo(()=>({rowHeight:u,gap:h,variant:i}),[u,h,i]),b=i==="masonry"?{columnCount:r,columnGap:h,...I}:{gridTemplateColumns:`repeat(${r}, 1fr)`,gap:h,...I},C={...c,component:v,gap:h,rowHeight:u,variant:i},L=re(C);return e.jsx(le,{as:v,className:B(L.root,L[i],g),ref:o,style:b,ownerState:C,...m,children:e.jsx(k.Provider,{value:f,children:n})})});function me(s){return W("MuiImageListItem",s)}const M=F("MuiImageListItem",["root","img","standard","woven","masonry","quilted"]),pe=s=>{const{classes:t,variant:o}=s;return D({root:["root",o],img:["img"]},me,t)},de=R("li",{name:"MuiImageListItem",slot:"Root",overridesResolver:(s,t)=>{const{ownerState:o}=s;return[{[`& .${M.img}`]:t.img},t.root,t[o.variant]]}})({display:"block",position:"relative",[`& .${M.img}`]:{objectFit:"cover",width:"100%",height:"100%",display:"block"},variants:[{props:{variant:"standard"},style:{display:"flex",flexDirection:"column"}},{props:{variant:"woven"},style:{height:"100%",alignSelf:"center","&:nth-of-type(even)":{height:"70%"}}},{props:{variant:"standard"},style:{[`& .${M.img}`]:{height:"auto",flexGrow:1}}}]}),ge=l.forwardRef(function(t,o){const c=A({props:t,name:"MuiImageListItem"}),{children:n,className:g,cols:r=1,component:v="li",rows:u=1,style:h,...I}=c,{rowHeight:i="auto",gap:m,variant:f}=l.useContext(k);let b="auto";f==="woven"?b=void 0:i!=="auto"&&(b=i*u+m*(u-1));const C={...c,cols:r,component:v,gap:m,rowHeight:i,rows:u,variant:f},L=pe(C);return e.jsx(de,{as:v,className:B(L.root,L[f],g),ref:o,style:{height:b,gridColumnEnd:f!=="masonry"?`span ${r}`:void 0,gridRowEnd:f!=="masonry"?`span ${u}`:void 0,marginBottom:f==="masonry"?m:void 0,breakInside:f==="masonry"?"avoid":void 0,...h},ownerState:C,...I,children:l.Children.map(n,y=>l.isValidElement(y)?y.type==="img"||G(y,["Image"])?l.cloneElement(y,{className:B(L.img,y.props.className)}):y:null)})});function ue(s){return W("MuiImageListItemBar",s)}F("MuiImageListItemBar",["root","positionBottom","positionTop","positionBelow","actionPositionLeft","actionPositionRight","titleWrap","titleWrapBottom","titleWrapTop","titleWrapBelow","titleWrapActionPosLeft","titleWrapActionPosRight","title","subtitle","actionIcon","actionIconActionPosLeft","actionIconActionPosRight"]);const he=s=>{const{classes:t,position:o,actionIcon:c,actionPosition:n}=s,g={root:["root",`position${w(o)}`,`actionPosition${w(n)}`],titleWrap:["titleWrap",`titleWrap${w(o)}`,c&&`titleWrapActionPos${w(n)}`],title:["title"],subtitle:["subtitle"],actionIcon:["actionIcon",`actionIconActionPos${w(n)}`]};return D(g,ue,t)},fe=R("div",{name:"MuiImageListItemBar",slot:"Root",overridesResolver:(s,t)=>{const{ownerState:o}=s;return[t.root,t[`position${w(o.position)}`]]}})($(({theme:s})=>({position:"absolute",left:0,right:0,background:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",fontFamily:s.typography.fontFamily,variants:[{props:{position:"bottom"},style:{bottom:0}},{props:{position:"top"},style:{top:0}},{props:{position:"below"},style:{position:"relative",background:"transparent",alignItems:"normal"}}]}))),ve=R("div",{name:"MuiImageListItemBar",slot:"TitleWrap",overridesResolver:(s,t)=>{const{ownerState:o}=s;return[t.titleWrap,t[`titleWrap${w(o.position)}`],o.actionIcon&&t[`titleWrapActionPos${w(o.actionPosition)}`]]}})($(({theme:s})=>({flexGrow:1,padding:"12px 16px",color:(s.vars||s).palette.common.white,overflow:"hidden",variants:[{props:{position:"below"},style:{padding:"6px 0 12px",color:"inherit"}},{props:({ownerState:t})=>t.actionIcon&&t.actionPosition==="left",style:{paddingLeft:0}},{props:({ownerState:t})=>t.actionIcon&&t.actionPosition==="right",style:{paddingRight:0}}]}))),xe=R("div",{name:"MuiImageListItemBar",slot:"Title",overridesResolver:(s,t)=>t.title})($(({theme:s})=>({fontSize:s.typography.pxToRem(16),lineHeight:"24px",textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"}))),Ie=R("div",{name:"MuiImageListItemBar",slot:"Subtitle",overridesResolver:(s,t)=>t.subtitle})($(({theme:s})=>({fontSize:s.typography.pxToRem(12),lineHeight:1,textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"}))),ye=R("div",{name:"MuiImageListItemBar",slot:"ActionIcon",overridesResolver:(s,t)=>{const{ownerState:o}=s;return[t.actionIcon,t[`actionIconActionPos${w(o.actionPosition)}`]]}})({variants:[{props:{actionPosition:"left"},style:{order:-1}}]}),je=l.forwardRef(function(t,o){const c=A({props:t,name:"MuiImageListItemBar"}),{actionIcon:n,actionPosition:g="right",className:r,subtitle:v,title:u,position:h="bottom",...I}=c,i={...c,position:h,actionPosition:g},m=he(i);return e.jsxs(fe,{ownerState:i,className:B(m.root,r),ref:o,...I,children:[e.jsxs(ve,{ownerState:i,className:m.titleWrap,children:[e.jsx(xe,{className:m.title,children:u}),v?e.jsx(Ie,{className:m.subtitle,children:v}):null]}),n?e.jsx(ye,{ownerState:i,className:m.actionIcon,children:n}):null]})});function $e(){var E;const[s,t]=l.useState([]),[o,c]=l.useState(!0),[n,g]=l.useState([]),[r,v]=l.useState(null),[u,h]=l.useState(!1),[I,i]=l.useState({open:!1,message:"",severity:"info"}),m=`${window.location.origin}`;l.useEffect(()=>{f()},[]);const f=async()=>{try{const a=await O();t(a||[])}catch{i({open:!0,message:"Failed to load records.",severity:"error"})}finally{c(!1)}},b=a=>{const x=Array.from(a.target.files).map(j=>({file:j,tag:""}));g(x)},C=async()=>{var d,x,j;if(n.length===0){i({open:!0,message:"Please select files to upload.",severity:"error"});return}if(n.some(p=>!p.tag.trim())){i({open:!0,message:"Please enter tags for all files.",severity:"error"});return}if(!(r!=null&&r.ordinance_id)){i({open:!0,message:"Ordinance ID is required.",severity:"error"});return}try{const p=new FormData;n.forEach(({file:_,tag:H})=>{p.append("files",_),p.append("file_tags",H)}),p.append("ordinance_id",r.ordinance_id);const T=await Q(p),U=((d=T==null?void 0:T.data)==null?void 0:d.message)||"Documentation uploaded successfully.";i({open:!0,message:U,severity:"success"}),y(),f()}catch(p){console.error("Error saving documentation:",p),i({open:!0,message:((j=(x=p==null?void 0:p.response)==null?void 0:x.data)==null?void 0:j.message)||"Failed to save documentation. Please try again.",severity:"error"})}},L=a=>{v(a),h(!0),g([])},y=()=>{h(!1),v(null),g([])};return o?e.jsx(V,{}):e.jsxs(q,{children:[e.jsx("h2",{children:"Documentation Records"}),e.jsx(Y,{children:e.jsxs(J,{children:[e.jsx(K,{children:e.jsxs(N,{children:[e.jsx(S,{children:"Title"}),e.jsx(S,{children:"Tags"}),e.jsx(S,{children:"Action/s"})]})}),e.jsx(X,{children:s.filter(a=>a.title!==null).map(a=>{var d;return e.jsxs(N,{sx:{mb:2},children:[e.jsx(S,{children:a.title}),e.jsx(S,{children:(d=a.documentation_reports)==null?void 0:d.map((x,j,p)=>e.jsxs("span",{children:[`${x.tag}${j===p.length-1?" ":","} `,console.log(p.length)]},j))}),e.jsx(S,{children:e.jsx(P,{variant:"outlined",onClick:()=>L(a),children:"View / Add Files"})})]},a.ordinance_id)})})]})}),e.jsxs(Z,{open:u,onClose:y,maxWidth:"sm",fullScreen:!0,children:[e.jsx(ee,{children:"Upload Documentation Files"}),e.jsxs(te,{dividers:!0,children:[e.jsx("input",{type:"file",multiple:!0,accept:".png,.jpg,.jpeg,.pdf,.docx",onChange:b,style:{marginBottom:"20px"}}),n.length>0&&n.map((a,d)=>e.jsxs(z,{sx:{mb:2},children:[e.jsxs("p",{children:["ðŸ“„ ",a.file.name]}),e.jsx(se,{fullWidth:!0,label:"Tag (e.g. memo, voucher, attendance sheet)",variant:"outlined",value:a.tag,onChange:x=>{const j=[...n];j[d].tag=x.target.value,g(j)}})]},d)),((E=r==null?void 0:r.documentation_reports)==null?void 0:E.length)>0&&e.jsxs("div",{children:[e.jsx("h4",{children:"Uploaded Files"}),e.jsx(ce,{sx:{width:"100%",height:"auto"},cols:3,gap:8,children:r.documentation_reports.map((a,d)=>{var x;return e.jsxs(ge,{children:[a.filepath.match(/\.(jpg|jpeg|png)$/)?e.jsx("img",{src:`${m}/${a.filepath}`,alt:`File ${d}`,style:{width:"100%",height:"100%",maxHeight:"550px",borderRadius:"8px"}}):e.jsx("iframe",{src:`${m}/${a.filepath}`,title:`File ${d}`,style:{width:"100%",height:"100%",maxHeight:"calc(50% -10px)",borderRadius:"8px"}}),e.jsx(je,{title:(x=a.related_documents)==null?void 0:x.join(", "),position:"below"})]},d)})})]})]}),e.jsxs(oe,{children:[e.jsx(P,{onClick:y,children:"Cancel"}),e.jsx(P,{variant:"contained",onClick:C,children:"Save"})]})]}),e.jsx(ie,{open:I.open,autoHideDuration:4e3,onClose:()=>i({open:!1,message:"",severity:"info"}),children:e.jsx(ae,{onClose:()=>i({open:!1,message:"",severity:"info"}),severity:I.severity,sx:{width:"100%"},children:I.message})})]})}export{$e as default};
