import{ac as E,j as e,a as l,ad as J,a5 as K,B as _,Q as w,ae as T,af as D,ag as X,ah as Y,ai as Z,aj as ee}from"./index-CJhurDKw.js";import{T as u,F as ae,I as se,S as re}from"./TextField-Gt7KocES.js";import{T as te,a as ne,b as le,c as W,d as n,e as ie}from"./TableRow-BR0V0JYl.js";import{I as v}from"./IconButton-BvZfMOCL.js";import{D as oe,a as de,b as ue}from"./DialogTitle-XUSj7cbv.js";import{C as ce,T as me}from"./Close-Dy_xA5Zf.js";import{M as A}from"./MenuItem-YB8qunKC.js";const he=E(e.jsx("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6z"}),"Add"),fe=E([e.jsx("circle",{cx:"12",cy:"12",r:"3.2"},"0"),e.jsx("path",{d:"M9 2 7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5"},"1")],"PhotoCamera"),Ce=()=>{const[R,q]=l.useState([]),[C,k]=l.useState(""),[g,b]=l.useState(0),[c,L]=l.useState(10),[M,U]=l.useState(!1),[o,p]=l.useState(!1),[B,y]=l.useState(null),[O,m]=l.useState(null),[s,h]=l.useState({username:"",password:"",role:"user",user_firstname:"",user_middlename:"",user_lastname:"",user_office:"",user_email:"",user_image:null}),[x,N]=l.useState(null);l.useEffect(()=>{(async()=>{try{const r=await X();N(r)}catch(r){console.error("Failed to fetch current user",r)}})(),f()},[]),l.useEffect(()=>{f()},[]);const f=async()=>{try{const a=await J();q(a)}catch(a){console.error("Error fetching users:",a)}},z=async a=>{if(window.confirm("Are you sure you want to delete this user?"))try{await Y(a),f()}catch(r){console.error("Error deleting user:",r),alert("Failed to delete the user.")}},H=a=>{k(a.target.value)},Q=(a,r)=>{b(r)},$=a=>{L(parseInt(a.target.value,10)),b(0)},S=(a=null)=>{a?(p(!0),y(a.id),h({username:a.username,password:"",role:a.role,user_firstname:a.user_firstname,user_middlename:a.user_middlename,user_lastname:a.user_lastname,user_office:a.user_office,user_email:a.user_email,user_image:a.user_image}),m(a.user_image?D(a.user_image):"/default-avatar.png")):(p(!1),h({username:"",password:"",role:"user",user_firstname:"",user_middlename:"",user_lastname:"",user_office:"",user_email:"",user_image:null}),m("/default-avatar.png")),U(!0)},j=()=>{U(!1),p(!1),y(null),m(null)},d=a=>{h({...s,[a.target.name]:a.target.value})},V=a=>{const r=a.target.files[0];if(r){const i=new FileReader;i.onloadend=()=>{m(i.result),h({...s,user_image:r})},i.readAsDataURL(r)}},G=async a=>{var r,i,I,F;a.preventDefault();try{const t=new FormData;if(t.append("username",s.username),t.append("role",s.role),t.append("user_firstname",s.user_firstname),t.append("user_middlename",s.user_middlename),t.append("user_lastname",s.user_lastname),t.append("user_office",s.user_office),t.append("user_email",s.user_email),!o&&s.password.trim()===""){alert("Password is required for new users!");return}s.password.trim()&&t.append("password",s.password),s.user_image instanceof File&&t.append("user_image",s.user_image),o?await Z(B,t):await ee(t),alert(o?"User updated successfully!":"User added successfully!"),f(),j()}catch(t){console.error("Error saving user:",((i=(r=t.response)==null?void 0:r.data)==null?void 0:i.error)||t.message),alert("Failed to save user: "+(((F=(I=t.response)==null?void 0:I.data)==null?void 0:F.error)||t.message))}},P=R.filter(a=>Object.entries(a).filter(([r])=>r!=="password").some(([r,i])=>i&&i.toString().toLowerCase().includes(C.toLowerCase())));return e.jsxs(K,{children:[e.jsxs(_,{display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%",mb:2,children:[e.jsx(u,{label:"Search User",variant:"outlined",size:"small",value:C,onChange:H,sx:{width:250}}),(x==null?void 0:x.role)==="admin"&&e.jsx(w,{variant:"contained",startIcon:e.jsx(he,{}),onClick:()=>S(),sx:{whiteSpace:"nowrap"},children:"Add User"})]}),e.jsx(te,{children:e.jsxs(ne,{stickyHeader:!0,size:"medium",children:[e.jsx(le,{children:e.jsxs(W,{children:[e.jsx(n,{children:"Profile"}),e.jsx(n,{children:"Username"}),e.jsx(n,{children:"Full Name"}),e.jsx(n,{children:"Email"}),e.jsx(n,{children:"Office"}),e.jsx(n,{children:"Role"}),e.jsx(n,{children:"Actions"})]})}),e.jsx(ie,{children:P.slice(g*c,g*c+c).map(a=>e.jsxs(W,{hover:!0,children:[e.jsx(n,{children:e.jsx(T,{src:a.user_image?D(a.user_image):"/default-avatar.png",alt:a.username})}),e.jsx(n,{children:a.username}),e.jsx(n,{children:`${a.user_firstname} ${a.user_middlename} ${a.user_lastname}`}),e.jsx(n,{children:a.user_email}),e.jsx(n,{children:a.user_office}),e.jsx(n,{children:a.role}),e.jsxs(n,{children:[e.jsx(v,{onClick:()=>S(a),children:e.jsx("img",{src:"/edit.svg",alt:"edit"})}),e.jsx(v,{color:"error",onClick:()=>z(a.id),children:e.jsx("img",{src:"/trash.svg",alt:"delete"})})]})]},a.id))})]})}),e.jsxs(oe,{open:M,onClose:j,maxWidth:"sm",fullWidth:!0,children:[e.jsxs(de,{children:[o?"Edit User":"Add User",e.jsx(v,{onClick:j,style:{float:"right"},children:e.jsx(ce,{})})]}),e.jsx(ue,{dividers:!0,children:e.jsxs("form",{onSubmit:G,children:[e.jsxs(_,{display:"flex",alignItems:"center",gap:2,mb:2,children:[e.jsx(T,{src:O,sx:{width:80,height:80}}),e.jsxs(w,{component:"label",variant:"contained",startIcon:e.jsx(fe,{}),children:["Upload Image",e.jsx("input",{type:"file",hidden:!0,accept:"image/*",onChange:V})]})]}),e.jsx(u,{label:"Username",name:"username",value:s.username,onChange:d,fullWidth:!0,margin:"normal",required:!0,disabled:o}),e.jsx(u,{label:o?"New Password (Leave blank to keep current password)":"Password",name:"password",type:"password",value:s.password,onChange:d,fullWidth:!0,margin:"normal",required:!o}),e.jsx(u,{label:"First Name",name:"user_firstname",value:s.user_firstname,onChange:d,fullWidth:!0,margin:"normal",required:!0}),e.jsx(u,{label:"Middle Name",name:"user_middlename",value:s.user_middlename,onChange:d,fullWidth:!0,margin:"normal"}),e.jsx(u,{label:"Last Name",name:"user_lastname",value:s.user_lastname,onChange:d,fullWidth:!0,margin:"normal",required:!0}),e.jsx(u,{label:"Office",name:"user_office",value:s.user_office,onChange:d,fullWidth:!0,margin:"normal",required:!0}),e.jsx(u,{label:"Email",name:"user_email",type:"email",value:s.user_email,onChange:d,fullWidth:!0,margin:"normal",required:!0}),e.jsxs(ae,{fullWidth:!0,margin:"normal",children:[e.jsx(se,{children:"Role"}),e.jsxs(re,{name:"role",value:s.role,onChange:d,required:!0,children:[e.jsx(A,{value:"admin",children:"Admin"}),e.jsx(A,{value:"user",children:"User"})]})]}),e.jsx(w,{type:"submit",variant:"contained",fullWidth:!0,sx:{mt:2},children:o?"Update User":"Add User"})]})})]}),e.jsx(_,{sx:{position:"absolute",bottom:0,right:0},children:e.jsx(me,{rowsPerPageOptions:[10,20,100],component:"div",count:P.length,rowsPerPage:c,page:g,onPageChange:Q,onRowsPerPageChange:$})})]})};export{Ce as default};
