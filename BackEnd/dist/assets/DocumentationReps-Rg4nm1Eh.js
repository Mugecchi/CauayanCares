import{k as W,q as A,a as l,s as D,j as t,t as R,b as B,i as F,aC as q,X as w,v as T,aD as G,ak as O,J as V,Z as P,K as z,aE as J}from"./index-C8JWgRoo.js";import{T as K,a as X,b as Y,c as E,d as S,e as Z}from"./TableRow-Dpjbb2Q3.js";import{D as Q,a as tt,b as et}from"./DialogTitle-B9vAwaz6.js";import{T as st}from"./TextField-BohWtvo1.js";import{D as ot}from"./DialogActions-DYjaLRLY.js";import{S as it,A as at}from"./Snackbar-DjSpNZEz.js";function nt(s){return W("MuiImageList",s)}A("MuiImageList",["root","masonry","quilted","standard","woven"]);const N=l.createContext({}),rt=s=>{const{classes:e,variant:o}=s;return F({root:["root",o]},nt,e)},lt=R("ul",{name:"MuiImageList",slot:"Root",overridesResolver:(s,e)=>{const{ownerState:o}=s;return[e.root,e[o.variant]]}})({display:"grid",overflowY:"auto",listStyle:"none",padding:0,WebkitOverflowScrolling:"touch",variants:[{props:{variant:"masonry"},style:{display:"block"}}]}),ct=l.forwardRef(function(e,o){const c=D({props:e,name:"MuiImageList"}),{children:n,className:g,cols:r=2,component:v="ul",rowHeight:u="auto",gap:h=4,style:x,variant:i="standard",...m}=c,f=l.useMemo(()=>({rowHeight:u,gap:h,variant:i}),[u,h,i]),b=i==="masonry"?{columnCount:r,columnGap:h,...x}:{gridTemplateColumns:`repeat(${r}, 1fr)`,gap:h,...x},C={...c,component:v,gap:h,rowHeight:u,variant:i},L=rt(C);return t.jsx(lt,{as:v,className:B(L.root,L[i],g),ref:o,style:b,ownerState:C,...m,children:t.jsx(N.Provider,{value:f,children:n})})});function mt(s){return W("MuiImageListItem",s)}const M=A("MuiImageListItem",["root","img","standard","woven","masonry","quilted"]),pt=s=>{const{classes:e,variant:o}=s;return F({root:["root",o],img:["img"]},mt,e)},dt=R("li",{name:"MuiImageListItem",slot:"Root",overridesResolver:(s,e)=>{const{ownerState:o}=s;return[{[`& .${M.img}`]:e.img},e.root,e[o.variant]]}})({display:"block",position:"relative",[`& .${M.img}`]:{objectFit:"cover",width:"100%",height:"100%",display:"block"},variants:[{props:{variant:"standard"},style:{display:"flex",flexDirection:"column"}},{props:{variant:"woven"},style:{height:"100%",alignSelf:"center","&:nth-of-type(even)":{height:"70%"}}},{props:{variant:"standard"},style:{[`& .${M.img}`]:{height:"auto",flexGrow:1}}}]}),gt=l.forwardRef(function(e,o){const c=D({props:e,name:"MuiImageListItem"}),{children:n,className:g,cols:r=1,component:v="li",rows:u=1,style:h,...x}=c,{rowHeight:i="auto",gap:m,variant:f}=l.useContext(N);let b="auto";f==="woven"?b=void 0:i!=="auto"&&(b=i*u+m*(u-1));const C={...c,cols:r,component:v,gap:m,rowHeight:i,rows:u,variant:f},L=pt(C);return t.jsx(dt,{as:v,className:B(L.root,L[f],g),ref:o,style:{height:b,gridColumnEnd:f!=="masonry"?`span ${r}`:void 0,gridRowEnd:f!=="masonry"?`span ${u}`:void 0,marginBottom:f==="masonry"?m:void 0,breakInside:f==="masonry"?"avoid":void 0,...h},ownerState:C,...x,children:l.Children.map(n,y=>l.isValidElement(y)?y.type==="img"||q(y,["Image"])?l.cloneElement(y,{className:B(L.img,y.props.className)}):y:null)})});function ut(s){return W("MuiImageListItemBar",s)}A("MuiImageListItemBar",["root","positionBottom","positionTop","positionBelow","actionPositionLeft","actionPositionRight","titleWrap","titleWrapBottom","titleWrapTop","titleWrapBelow","titleWrapActionPosLeft","titleWrapActionPosRight","title","subtitle","actionIcon","actionIconActionPosLeft","actionIconActionPosRight"]);const ht=s=>{const{classes:e,position:o,actionIcon:c,actionPosition:n}=s,g={root:["root",`position${w(o)}`,`actionPosition${w(n)}`],titleWrap:["titleWrap",`titleWrap${w(o)}`,c&&`titleWrapActionPos${w(n)}`],title:["title"],subtitle:["subtitle"],actionIcon:["actionIcon",`actionIconActionPos${w(n)}`]};return F(g,ut,e)},ft=R("div",{name:"MuiImageListItemBar",slot:"Root",overridesResolver:(s,e)=>{const{ownerState:o}=s;return[e.root,e[`position${w(o.position)}`]]}})(T(({theme:s})=>({position:"absolute",left:0,right:0,background:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",fontFamily:s.typography.fontFamily,variants:[{props:{position:"bottom"},style:{bottom:0}},{props:{position:"top"},style:{top:0}},{props:{position:"below"},style:{position:"relative",background:"transparent",alignItems:"normal"}}]}))),vt=R("div",{name:"MuiImageListItemBar",slot:"TitleWrap",overridesResolver:(s,e)=>{const{ownerState:o}=s;return[e.titleWrap,e[`titleWrap${w(o.position)}`],o.actionIcon&&e[`titleWrapActionPos${w(o.actionPosition)}`]]}})(T(({theme:s})=>({flexGrow:1,padding:"12px 16px",color:(s.vars||s).palette.common.white,overflow:"hidden",variants:[{props:{position:"below"},style:{padding:"6px 0 12px",color:"inherit"}},{props:({ownerState:e})=>e.actionIcon&&e.actionPosition==="left",style:{paddingLeft:0}},{props:({ownerState:e})=>e.actionIcon&&e.actionPosition==="right",style:{paddingRight:0}}]}))),It=R("div",{name:"MuiImageListItemBar",slot:"Title",overridesResolver:(s,e)=>e.title})(T(({theme:s})=>({fontSize:s.typography.pxToRem(16),lineHeight:"24px",textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"}))),xt=R("div",{name:"MuiImageListItemBar",slot:"Subtitle",overridesResolver:(s,e)=>e.subtitle})(T(({theme:s})=>({fontSize:s.typography.pxToRem(12),lineHeight:1,textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"}))),yt=R("div",{name:"MuiImageListItemBar",slot:"ActionIcon",overridesResolver:(s,e)=>{const{ownerState:o}=s;return[e.actionIcon,e[`actionIconActionPos${w(o.actionPosition)}`]]}})({variants:[{props:{actionPosition:"left"},style:{order:-1}}]}),jt=l.forwardRef(function(e,o){const c=D({props:e,name:"MuiImageListItemBar"}),{actionIcon:n,actionPosition:g="right",className:r,subtitle:v,title:u,position:h="bottom",...x}=c,i={...c,position:h,actionPosition:g},m=ht(i);return t.jsxs(ft,{ownerState:i,className:B(m.root,r),ref:o,...x,children:[t.jsxs(vt,{ownerState:i,className:m.titleWrap,children:[t.jsx(It,{className:m.title,children:u}),v?t.jsx(xt,{className:m.subtitle,children:v}):null]}),n?t.jsx(yt,{ownerState:i,className:m.actionIcon,children:n}):null]})});function Bt(){var k;const[s,e]=l.useState([]),[o,c]=l.useState(!0),[n,g]=l.useState([]),[r,v]=l.useState(null),[u,h]=l.useState(!1),[x,i]=l.useState({open:!1,message:"",severity:"info"}),m=`${window.location.origin}`;l.useEffect(()=>{f()},[]);const f=async()=>{try{const a=await G();e(a||[])}catch{i({open:!0,message:"Failed to load records.",severity:"error"})}finally{c(!1)}},b=a=>{const I=Array.from(a.target.files).map(j=>({file:j,tag:""}));g(I)},C=async()=>{var p,I,j;if(n.length===0){i({open:!0,message:"Please select files to upload.",severity:"error"});return}if(n.some(d=>!d.tag.trim())){i({open:!0,message:"Please enter tags for all files.",severity:"error"});return}if(!(r!=null&&r.ordinance_id)){i({open:!0,message:"Ordinance ID is required.",severity:"error"});return}try{const d=new FormData;n.forEach(({file:_,tag:H})=>{d.append("files",_),d.append("file_tags",H)}),d.append("ordinance_id",r.ordinance_id);const $=await J(d),U=((p=$==null?void 0:$.data)==null?void 0:p.message)||"Documentation uploaded successfully.";i({open:!0,message:U,severity:"success"}),y(),f()}catch(d){console.error("Error saving documentation:",d),i({open:!0,message:((j=(I=d==null?void 0:d.response)==null?void 0:I.data)==null?void 0:j.message)||"Failed to save documentation. Please try again.",severity:"error"})}},L=a=>{v(a),h(!0),g([])},y=()=>{h(!1),v(null),g([])};return t.jsxs(O,{children:[t.jsx(V,{variant:"h4",color:"#fff",children:"Documentation Records"}),t.jsx(K,{children:t.jsxs(X,{children:[t.jsx(Y,{children:t.jsxs(E,{children:[t.jsx(S,{children:"Title"}),t.jsx(S,{children:"Tags"}),t.jsx(S,{children:"Action/s"})]})}),t.jsx(Z,{children:s.filter(a=>a.title!==null).map(a=>{var p;return t.jsxs(E,{sx:{mb:2},children:[t.jsx(S,{children:a.title}),t.jsx(S,{children:(p=a.documentation_reports)==null?void 0:p.map((I,j,d)=>t.jsx("span",{children:`${I.tag}${j===d.length-1?" ":","} `},j))}),t.jsx(S,{children:t.jsx(P,{variant:"outlined",onClick:()=>L(a),children:"View / Add Files"})})]},a.ordinance_id)})})]})}),t.jsxs(Q,{open:u,onClose:y,maxWidth:"sm",fullScreen:!0,children:[t.jsx(tt,{children:"Upload Documentation Files"}),t.jsxs(et,{dividers:!0,children:[t.jsx("input",{type:"file",multiple:!0,accept:".png,.jpg,.jpeg,.pdf,.docx",onChange:b,style:{marginBottom:"20px"}}),n.length>0&&n.map((a,p)=>t.jsxs(z,{sx:{mb:2},children:[t.jsxs("p",{children:["ðŸ“„ ",a.file.name]}),t.jsx(st,{fullWidth:!0,label:"Tag (e.g. memo, voucher, attendance sheet)",variant:"outlined",value:a.tag,onChange:I=>{const j=[...n];j[p].tag=I.target.value,g(j)}})]},p)),((k=r==null?void 0:r.documentation_reports)==null?void 0:k.length)>0&&t.jsxs("div",{children:[t.jsx("h4",{children:"Uploaded Files"}),t.jsx(ct,{sx:{width:"100%",height:"auto"},cols:3,gap:8,children:r.documentation_reports.map((a,p)=>{var I;return t.jsxs(gt,{children:[a.filepath.match(/\.(jpg|jpeg|png)$/)?t.jsx("img",{src:`${m}/${a.filepath}`,alt:`File ${p}`,style:{width:"100%",height:"100%",maxHeight:"550px",borderRadius:"8px"}}):t.jsx("iframe",{src:`${m}/${a.filepath}`,title:`File ${p}`,style:{width:"100%",height:"100%",maxHeight:"calc(50% -10px)",borderRadius:"8px"}}),t.jsx(jt,{title:(I=a.related_documents)==null?void 0:I.join(", "),position:"below"})]},p)})})]})]}),t.jsxs(ot,{children:[t.jsx(P,{onClick:y,children:"Cancel"}),t.jsx(P,{variant:"contained",onClick:C,children:"Save"})]})]}),t.jsx(it,{open:x.open,autoHideDuration:4e3,onClose:()=>i({open:!1,message:"",severity:"info"}),children:t.jsx(at,{onClose:()=>i({open:!1,message:"",severity:"info"}),severity:x.severity,sx:{width:"100%"},children:x.message})})]})}export{Bt as default};
